---
title: 分析異常儲存庫增長
description: 說明
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager 6.4,Experience Manager 6.5
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: 10/21/2021 9:42:02 PM
article-published-by: Cedric Latimier
article-published-date: 1/18/2022 2:45:04 PM
version-number: 1
article-number: KA-17496
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=6654cfb6-b732-ec11-b6e5-000d3a5ba97a
exl-id: 51d503fe-3da6-4cfc-a8c5-95f80da51ae8
source-git-commit: 0c3e421beca46d9fe1952b1f98538a50697216a0
workflow-type: tm+mt
source-wordcount: '534'
ht-degree: 0%

---

# 分析異常儲存庫增長

## 說明


在AEM伺服器上，磁碟使用率異常且快速增加。
<br><br><br><br>原因<br><br><br><br><br><br>
許多事物都可能導致磁碟利用率異常增加。  一些潛在原因：

1. 未在系統上運行正確的維護。  請參閱 [這篇文章](https://helpx.adobe.com/experience-manager/kb/AEM6-Maintenance-Guide.html) 有關各種系統維護活動的詳細資訊。
2. AEM或應用程式正在建立大量節點或對節點屬性進行更新。  這可能是因為配置錯誤或應用程式代碼錯誤。  由於Oak中的tar儲存以僅附加模式運作，重複儲存節點會進一步導致存放庫成長過量。
3. 超大型檔案已上傳至AEM Assets或封裝管理員。
4. Debug或Trace記錄仍為啟用狀態。



## 解析度

A.如果AEM正在執行，且磁碟空間充足<br><br><br><br> <br><br>1. 設定OAK WRITETRACE記錄<br><br><br><br> <br><br>如果AEM仍在執行，則可啟用除錯記錄器，告訴我們要寫入的存放庫路徑。  要啟用此記錄器，請在下面安裝附加的日誌配置包，或按照以下步驟操作：
1. 前往 <b>*http://aemhost:port*/system/console/slinglog</b>
2. 按一下 <b>[!UICONTROL 添加新記錄器]</b>
3. 配置記錄器： <b>[!UICONTROL 記錄檔]: `logs/repgrowth.log`</b>, <b>[!UICONTROL 記錄層級]: `trace`</b>, <b>[!UICONTROL 記錄器]:</b> <b>`org.apache.jackrabbit.oak.jcr.operations.writes`</b>


下載
[取得檔案](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/analyze-unusual-repository-growth/jcr:content/main-pars/download/log_repository_growth-1.zip "log_repository_growth-1.zip") <br><br>此套件包含Oak記錄寫入工作階段的必要設定。 透過CRX套件管理器安裝此套件。 監視期間過後，請務必卸載該包。<br><br><br><br><br><br><br><br> <br><br><br><br><br><br> <br><br><br><br><br><br><br><br><br>
注意：

- 日誌包含有關所有寫入和會話詳細資訊的資訊。  如果使用此記錄器，請確保您有足夠的磁碟空間。
- 卸載日誌配置包，或在短時間內啟用日誌配置以避免進一步佔用磁碟空間。



<br><br><br><br> <br><br>2. 運行磁碟使用情況報告<br><br><br><br> <br><br>
您也可以運用 [!UICONTROL 磁碟使用情況] 報告 <b>*http://host:port*/etc/reports/diskusage.html</b>。此報告顯示儲存庫路徑使用的磁碟空間。  此報表可供深入檢視，也允許您檢視子樹。
<br><br><br><br> <br><br>3. 捕獲線程轉儲並執行效能分析<br><br><br><br> <br><br>
使用 <b>[repgrowth.log](https://helpx.adobe.com/experience-manager/kb/analyze-unusual-repository-growth.html#repgrowth)</b> 要了解正在寫入的資料，我們可以通過捕獲線程轉儲和運行CPU效能分析來獲取有關正在寫入資料的代碼的資訊。

請參閱下列文章：

- [CPU效能分析](https://helpx.adobe.com/experience-manager/kb/AnalyzeUsingBuiltInProfiler.html)
- [捕獲線程轉儲](https://helpx.adobe.com/experience-manager/kb/TakeThreadDump.html)
- [分析AEM線程轉儲](https://helpx.adobe.com/experience-manager/kb/thread-dump-analysis.html)

<br><br><br><br> <br><br>B.如果AEM停止，和/或磁碟空間幾乎用完<br><br><br><br> <br><br>
如果必須停止AEM以避免磁碟空間增長，請使用以下命令進行一些初始分析。

開啟 [!DNL Linux] 平台，利用 <b>`du`</b> 命令列出下面的所有目錄 <b>`crx-quickstart`</b> 以及這些目錄的摘要大小：

`du -h --max-depth=2 crx-quickstart`

使用 <b>`find`</b> 和 <b>`du`</b> 命令查找最近修改的檔案並獲取其大小：

`find crx-quickstart -type f -mtime 1 -exec du -hs {} \; -print`

若要在資料存放區中尋找大型檔案，您可以結合 <b>`find`</b>, <b>`du`</b> 和 <b>`file`</b> 在 <b>`datastore`</b> 目錄並自動識別其檔案類型：

`find crx-quickstart/repository/datastore -type f -size +100M -exec sh -c "du -hs \"{}\"; file \"{}\"" \;`

如果您發現 <b>`segmentstore`</b> 目錄，則下面的命令有助於提供關於正在寫入哪些資料的線索：

`strings data_xxxxxx.tar | egrep '.?/' | sed 's/.$//;s/.\//\//'`
