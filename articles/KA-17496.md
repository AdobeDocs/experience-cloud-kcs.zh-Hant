---
title: 「AEM Server上的磁碟使用率異常高或快速增加」
description: 說明
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager 6.4,Experience Manager 6.5"
keywords: "KCS, AEM，效能，磁碟已滿"
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "5/3/2023 2:43:16 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "5/3/2023 3:29:21 PM"
version-number: 5
article-number: KA-17496
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=7bc541d5-c0e9-ed11-a7c6-6045bd006b25"
source-git-commit: c013ee697b26d0af1dae9017a32b3d3d1f6bbb27
workflow-type: tm+mt
source-wordcount: '572'
ht-degree: 6%

---

# AEM Server上的磁碟使用率異常高或快速增加

## 說明 {#description}


<b>環境</b>

Adobe Experience Manager

<b>問題/症狀</b>

在AEM伺服器上，磁碟使用率異常高或快速增加。 磁碟空間用完後，AEM已停止運作。




## 解決方法 {#resolution}

<b>A.如果AEM正在執行，且磁碟空間充足</b>
1. <b>設定oak write trace記錄</b>    如果AEM仍在執行，則可啟用除錯記錄器，告訴我們要寫入的存放庫路徑。 要啟用此記錄器，請在下面安裝附加的日誌配置包，或按照以下步驟操作：

   1. 前往 *https://aemhost:port/system/console/slinglog*
   2. 按一下 <b>添加新記錄器</b>.
   3. 配置記錄器： <b>日誌檔案：</b> logs/repgrowth.log <b>記錄層級</b>:追蹤， <b>記錄器：</b> org.apache.jackrabbit.oak.jcr.operations.writes
   4. 下載 [檔案](https://helpx.adobe.com/content/dam/help/en/experience-manager/kb/analyze-unusual-repository-growth/jcr:content/main-pars/download/log_repository_growth-1.zip).        此套件包含Oak記錄寫入工作階段的必要設定。 透過CRX套件管理器安裝此套件。 監視期間過後，請務必卸載該包。

   <b>注意</b>

   - 日誌包含有關所有寫入和會話詳細資訊的資訊。 如果使用此記錄器，請確保您有足夠的磁碟空間。
   - 卸載日誌配置包，或在短時間內啟用日誌配置以避免進一步佔用磁碟空間。
2. <b>運行磁碟使用情況報告</b>    您也可以利用「磁碟使用情況」報告https://host:port/etc/reports/diskusage.html。 此報告顯示儲存庫路徑使用的磁碟空間。 此報表可供深入檢視，也允許您檢視子樹。
3. <b>捕獲線程轉儲並執行效能分析</b>    使用repgrowth.log獲取正在寫入哪些資料的一些概念後，我們可以通過捕獲線程轉儲和運行CPU效能分析來獲取有關正在寫入該資料的代碼的資訊。 請瀏覽以下頁面：

   - [CPU效能分析](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17499.html?lang=zh-Hant)
   - [捕獲線程轉儲](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-17452.html?lang=zh-Hant)
   - [分析AEM線程轉儲](https://experienceleague.adobe.com/docs/experience-cloud-kcs/kbarticles/KA-16458.html?lang=zh-Hant)

<b>B.如果AEM已停止和/或磁碟空間幾乎已滿</b>
如果您必須停止AEM以避免磁碟空間增加，請使用以下命令進行一些初始分析。

- 在Linux平台上， <b>杜</b> 命令列出下面的所有目錄 <b>crx-quickstart</b> 以及這些目錄的摘要大小：<br>

   ```
   du -h --max-depth=2 crx-quickstart
   ```


- 使用 <b>查找</b> 和 <b>杜</b> 命令查找最近修改的檔案並獲取其大小：<br>

   ```
   find crx-quickstart -type f -mtime 1 -exec du -hs {} \; -print
   ```


- 若要在資料存放區中尋找大型檔案，您可以結合 <b>查找</b>, <b>杜</b>，和 <b>檔案</b> 在 <b>資料存放區</b> 目錄並自動識別其檔案類型：<br>

   ```
   find crx-quickstart/repository/datastore -type f -size +100M -exec sh -c "du -hs \"{}\"; file \"{}\"" \;
   ```


- 若您發現 <b>segmentstore</b> 目錄，則下面的命令可能有助於指明寫入的資料：<br>

   ```
   strings data_xxxxxx.tar | egrep '.?/' | sed 's/.$//;s/.\//\//'
   ```

<b>原因</b>
磁碟利用率異常增加的一些潛在原因是：

- 未在系統上運行正確的維護。  有關各種系統維護活動的詳細資訊，請參閱本文。
- AEM或應用程式正在建立大量節點或對節點屬性進行更新。  這可能是因為配置錯誤或應用程式代碼錯誤。  由於Oak中的tar儲存以僅附加模式運作，重複儲存節點會進一步導致存放庫成長過量。
- 超大型檔案已上傳至AEM Assets或封裝管理員。
- Debug或Trace記錄仍為啟用狀態。

