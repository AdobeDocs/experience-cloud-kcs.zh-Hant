---
title: 「如何在Apache HTTP Server層級封鎖IP位址？」
description: 說明
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: 「KCS、封鎖IP位址、Apache HTTP伺服器、AEM Dispatcher」
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "5/24/2023 3:30:14 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "5/24/2023 3:38:10 PM"
version-number: 6
article-number: KA-17455
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=2365b1db-47fa-ed11-8849-6045bd006b3d"
source-git-commit: 1e84ba49e6ca4ddca5e5058ce62804df6d2835d5
workflow-type: tm+mt
source-wordcount: '247'
ht-degree: 1%

---

# 如何在Apache HTTP Server層級封鎖IP位址？

## 說明 {#description}

<b>環境</b>
Adobe Experience Manager


<b>問題/症狀</b>
我們的網站遭遇拒絕服務攻擊、垃圾郵件或遭駭客入侵。 如何封鎖Apache HTTP Server (AEM Dispatcher)層級的IP位址？


## 解決方法 {#resolution}


大部分的Web應用程式防火牆(WAF) （例如模組安全性）都可以封鎖IP位址清單。 不過，如果您執行Apache HTTP Server並希望立即封鎖IP，請按照以下步驟操作(*不適用於AEMas a Cloud Service<b>*)</b>：

1. 建立名為的檔案 `block-offending-ips.conf` 在您的伺服器上
2. 在編輯器中開啟檔案，並新增Location指示詞，以封鎖所有違反規定的IP存取您要封鎖的URL。 檔案內容有兩個選項：<br>    A.如果要求是經代理的（透過CDN、負載平衡器等），且遠端使用者的IP僅位於標頭（例如X-Forwarded-For）中，則可以使用此設定。 請注意，如果已設定remoteip_module，則此設定不適用。


   ```
   LocationMatch "/.*"
       Order Allow,Deny
       Allow from all
       SetEnvif X-Forwarded-For "10\.42\.137\.123" DenyAccess
       SetEnvif X-Forwarded-For "122\.6\.218\.101" DenyAccess
       #Repeat the "SetEnvlf X-Forwarded-For ..." for each IP you want to block
       Deny from env=DenyAccess
       /LocationMatch
   ```

   B.或者，如果遠端使用者直接存取Apache或您正在使用remoteip_module (請參閱 <b>`[` 1`]` </b> 在Apache中擷取及設定它，然後您可以使用mod_authz_core的 <b>需要</b> 直接功能(Apache 2.4)。


   ```
   LocationMatch "/.*"
       RequireAll
       Require all granted
       Require not ip 10.42.137.123
       Require not ip 122.6.218.101
       #Repeat the "Require not ip ..." for each IP you want to block
       /RequireAll
       /LocationMatch
   ```


   <b>`[` 1`]`  remoteip_module</b>


   ```
   # Extract true client IP from header added by load balancer/CDN
       IfModule remotetip module
       # valid for ELB or ELB+CloudFront
       RemoteIPHeader X-Forwarded-For
       IfModule
   ```


3. 將block-offending-ips.conf檔案拖放到Apache Web Server的/etc/conf.d資料夾中。
4. 重新啟動Apache HTTP Server。

