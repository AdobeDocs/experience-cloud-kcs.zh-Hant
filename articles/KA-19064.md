---
title: 如何透過oak-run執行資料存放區一致性檢查
description: 說明
solution: Experience Manager
product: Experience Manager
applies-to: Experience Manager
keywords: KCS
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Akash Kapoor
article-created-date: 4/3/2022 9:37:38 PM
article-published-by: Akash Kapoor
article-published-date: 4/3/2022 9:39:46 PM
version-number: 2
article-number: KA-19064
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=68a58547-96b3-ec11-983f-000d3a5d09d6
exl-id: 8aec0830-a1db-4e57-95e4-3745e87bde32
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '392'
ht-degree: 0%

---

# 如何透過oak-run執行資料存放區一致性檢查

## 說明

資料存放區一致性檢查會報告遺失但仍被參考的資料存放區二進位檔。 一致性檢查可由Felix主控台直接觸發。<br>
可從MarkSweepGarbageCollector#checkConsistency Mbean觸發

如果BlobGC MBean在MBeanServer中註冊，則還可以使用以下mbean:

BlobGCMbean#checkConsistency

一致性檢查完成後，訊息會顯示報告為遺失的二進位檔數。 如果數字大於0，請檢查為org.apache.jackrabbit.oak.plugins.blob .MarkSweepGarbageCollector設定的記錄檔，以取得遺失二進位檔的詳細資訊。

以下是記錄中如何回報遺失二進位檔的範例：

`11:32:39.673 INFO main MarkSweepGarbageCollector.java:600 Consistency check found 1 missing blobs 11:32:39.673 WARN main MarkSweepGarbageCollector.java:602 Consistency check failure in the the blob store : DataStore backed BlobStore org.apache.jackrabbit.oak.plugins.blob.datastore.OakFileDataStore, check missing candidates in file /tmp/gcworkdir-1467352959243/gccand-1467352959243`

與/system/console/repositorycheck UI不同，oak-run工具會檢查/oak下隱藏的lucene索引檔案：索引，以及其餘的內容路徑。 &quot;datastorecheck&quot;命令 <b>oak-run </b>可用於對資料存放區執行一致性檢查。  有關如何執行命令的詳細步驟如下：




## 解析度


1. 將oak-run jar 1.8.8或更新版本下載至AEM伺服器。
2. 將oak run jar放置在放置crx-quickstart的相同目錄中，否則提供oak-run-\*.jar在命令下執行時的完整路徑。
3. 執行以下命令（根據您的環境更新segmentstore和資料存放區的路徑）:


`java -jar oak-run-*.jar datastorecheck --consistency --ref --id --fds crx-quickstart/install/org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.config --repoHome crx-quickstart/repository --store crx-quickstart/repository/segmentstore --dump temp --verbose --track`

4. 命令將輸出資料儲存一致性檢查。

DataStore的一致性檢查器還可用於列出節點儲存中的所有blob引用以及資料儲存中可用的所有blob ID。 使用下列命令：

`$ java-jar oak-run-*.jar datastorecheck --id --ref --consistency \`

`--store | \`

`--s3ds |--fds \`

`--dump \`

`--track`



提供下列一或多個可用選項：

-id — 列出資料儲存區中的所有id。

-ref — 列出節點儲存區中的所有blob參照。

 — 一致性 — 通過一致性檢查列出所有缺少的blob。



下列選項為選用：

-store - mongo uri段儲存的路徑（上述「 — ref」和「 — consistency」選項的必需）。

—dump — 轉儲檔案的路徑（可選）。 否則，檔案將轉儲到用戶臨時目錄中。

-s3ds - S3DataStore配置檔案的路徑。

-fds - FileDataStore配置檔案的路徑（「path」屬性是必需的）。

-track — 本機存放庫首頁資料夾的路徑（可選）。 它會放置要追蹤的已下載blob ID復本。
