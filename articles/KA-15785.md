---
title: 最佳化資料庫更新精靈中產生的SQL查詢
description: 瞭解如何解決需將新欄新增到現有方案中的Adobe Campaign Classic問題。
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS、Campaign ClassicV7、最佳化產生的SQL查詢、資料庫更新精靈
resolution: Resolution
internal-notes: It can be helpful when dealing with database update issues with big tables
bug: true
article-created-by: Tanay Sharma .
article-created-date: 5/3/2024 12:44:18 PM
article-published-by: Tanay Sharma .
article-published-date: 5/3/2024 12:49:40 PM
version-number: 4
article-number: KA-15785
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=d6a7c3d4-4a09-ef11-9f8a-6045bd026dc7
exl-id: 73e8701c-88e5-4b73-8c55-90eaee26d2ac
source-git-commit: c93cdbdd7877c0c96dcfd01aa9f3eb982a280d8e
workflow-type: tm+mt
source-wordcount: '357'
ht-degree: 0%

---

# 最佳化資料庫更新精靈中產生的SQL查詢

## 說明 {#description}


<b>環境</b>
Adobe Campaign Adobe Campaign Classic

<b>問題</b>
在大多數Adobe Campaign組建（包括Gold Standard 9032組建）中，將新欄新增至現有結構描述時，您可能會遇到多個問題。

本文的範圍是解決一個與以下相關的特定問題：

- 當記錄已存在時，將整數欄位新增到現有結構描述。
- 將應用程式產生的SQL查詢最佳化為Postgres SQL的有效查詢。


<b>原因</b>
<br>舉例來說，如果您有現有的收件者表格或任何其他表格，而這些表格已擁有超過100萬筆記錄，就會發生此狀況。
<br>如果您現在需要新增一額外欄至資料型別的表格 `Integer`.
<br>然後，您在綱要定義中新增該欄，並想在資料庫中確認變更。

<br>更新資料庫時，資料庫遇到死結或查詢封鎖其他作業。
<br>這主要是將所有記錄更新至 *0* 根據資料庫精靈產生的SQL命令。<br>

## 解決方法 {#resolution}


<b>解決方案</b>
新增整數資料行時，會產生類似以下的SQL敘述句：


```
ALTER TABLE NmsRecipient ADD <column_name> SMALLINT;
UPDATE NmsRecipient SET <column_name> = 0;
ALTER TABLE NmsRecipient ALTER COLUMN <column_name> SET Default 0;
ALTER TABLE NmsRecipient ALTER COLUMN i<column_name> SET NOT NULL;
```


這裡的問題是資料庫中有4個並行執行的命令，可能會造成效能問題或死結。

解決方案是將這4個命令壓縮成一個，然後仍進行如下相同的變更：


```
ALTER TABLE NmsRecipient ADD iFichierLiveDataCliqueurs SMALLINT NOT NULL SET Default 0 ;
```


它會進行所有需要的變更、新增欄、設定預設值、設定 `NOT NULL`，並將現有記錄的值設定為 *0* 因為 `NOT NULL` 限制。



<b>注意：</b>

如果有多個整數欄需要新增，請逐一新增，然後針對每項變更執行資料庫精靈。

這是為了確保順暢的操作，因為此陳述式會更新所有 <b>現有 </b>記錄至 *0* 此外，根據記錄數量，這可能需要時間。
