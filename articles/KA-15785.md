---
title: Campaign ClassicV7 — 優化在資料庫更新嚮導中生成的SQL查詢
description: 說明
solution: Campaign,Campaign Classic v7
product: Campaign,Campaign Classic v7
applies-to: Campaign Classic,Campaign,Campaign Classic v7
keywords: KCS
resolution: Resolution
internal-notes: It can be helpful when dealing with database update issues with big tables
bug: true
article-created-by: Marta Zator
article-created-date: 5/5/2022 10:16:35 AM
article-published-by: Marta Zator
article-published-date: 5/5/2022 10:18:58 AM
version-number: 2
article-number: KA-15785
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e810bb6a-5ccc-ec11-a7b5-6045bd00dbbc
exl-id: 73e8701c-88e5-4b73-8c55-90eaee26d2ac
source-git-commit: e8f4ca2dd578944d4fe399074fab461de88ad247
workflow-type: tm+mt
source-wordcount: '366'
ht-degree: 1%

---

# Campaign ClassicV7 — 優化在資料庫更新嚮導中生成的SQL查詢

## 說明


<b>背景與內容：</b>
在包括Gold Standard 9032在內的大部分的Campaign組建中，在現有結構中新增欄時可能會遇到多個問題。

本文的範圍是解決一個與以下內容相關的具體問題：

- 當記錄已存在時，將整數欄位新增至現有架構。
- 將應用程式生成的SQL查詢優化為Postgres SQL的高效查詢。


<b>使用案例：</b> 
<br>我們有一個現有的收件人表或任何其他表，其中已有超過100萬條記錄。
<br>現在，我們需要在資料類型為整數的表格中額外新增一欄。
<br>我們將該列添加到架構定義中，並且要提交資料庫中的更改。

<b>挑戰 </b>:
<br>在更新資料庫時遇到問題，資料庫遇到死鎖或查詢阻止其他操作。
<br>這主要是因為根據資料庫嚮導生成的SQL命令將所有記錄更新為0。


<br> <br>

## 解析度


解決方案 :

新增整數欄時，我們會取得如下所產生的SQL陳述式：

<b>ALTER TABLE NmsRecipient ADD column_name SMALLINT;
<br>更新NmsRecipient SET column_name = 0;
<br>ALTER TABLE NmsRecipient ALTER COLUMN column_name SET Default 0;
<br>ALTER TABLE NmsRecipient ALTER COLUMN icolumn_name SET NOT NULL;</b>

這裡的問題是，資料庫中並行執行了4個命令，這可能導致效能問題或死鎖。

解決方案是將這4個命令濃縮為一個命令，並仍執行如下所示的相同更改：

<b>ALTER TABLE NmsRecipient ADD iFichierLiveDataCliquers SMALLINT NOT NULL SET Default 0 ;</b>

它執行所需的所有更改，添加列，設定預設值，設定NOT NULL，並且由於NOT NULL約束，將現有記錄的值設定為0。



<b>注意 :</b>

如果需要添加多個整數列，請逐個添加這些列，並針對每次更改運行資料庫嚮導。

這是為了確保操作順暢，因為語句會更新所有 <b>現有 </b>也會記錄為0，並視否而定。 記錄可能需要時間。
