---
title: "了解AEM Dispatcher快取的請求"
description: 說明
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: 「KCS」
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Roxann McGlumphy
article-created-date: "12/2/2022 9:08:56 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "3/23/2023 5:12:49 PM"
version-number: 2
article-number: KA-17497
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=0534af84-8572-ed11-9561-6045bd006079"
source-git-commit: 067464d20ff3960470a3ded0dcd15a8d6dbbc37b
workflow-type: tm+mt
source-wordcount: '440'
ht-degree: 7%

---

# 了解AEM Dispatcher快取的請求

## 說明 {#description}

<br>問題<br><br>
需要判斷AEM Dispatcher為何不快取HTTP要求/回應
<br><br>環境<br><br>
AEM Dispatcher 4.3.3


## 解決方法 {#resolution}


本檔案涵蓋的最重要案例會影響透過AEM Dispatcher模組處理之請求和回應的快取能力。 未涵蓋所有快取規則。

<b>HTTP要求與快取規則</b>

若要讓HTTP要求可供Dispatcher快取，它必須遵守下列規則：

1. URL是絕對的(不適用於。 或……)，則有副檔名，而URL中的檔案名稱可作為檔案系統上的檔案運作。
   <b>相關日誌消息：</b>


   ```
   URI not canonical: %s.    
   Unable to map URI to file: %s.    
   cache file path too long    
   temporary file path too long    
   request URL has no extension
   ```



   <b>範例：</b>


   | `/content/test` | 未快取 |
   | --- | --- |
   | `/content/test.html` | cached |


2. 第一個副檔名後面沒有斜線。<br>

   <b>相關日誌消息：</b>


   ```
   request URL has trailing slash
   ```



   <b>範例：</b>


   | `/content/test.html/` | 未快取 |
   | --- | --- |
   | `/content/test.html/foo.jpg` | 未快取 |
   | `/content/test.html` | cached |


3. 它使用HTTPGET或HEAD方法。<br>

   <b>相關日誌消息：</b>


   ```
   request method is neither GET nor HEAD
   ```



   <b>範例：</b>


   | `HEAD /content/test.html HTTP/1.1` | cached |
   | --- | --- |
   | `GET /content/dam/test.jpg HTTP/1.1` | 未快取 |
   | `POST /content/test.html HTTP/1.1` | 未快取 |


4. 由Dispatcher中定義的/CACHE = /RULES拒絕請求。 任何伺服器陣列配置。
   <b>相關日誌消息：</b>


   ```
   URI not  in cache rules: %s request URL not in cache rules
   ```



   <b>範例：</b>


   | <br><br>    ```<br>    Farm has /cache = /rules and a request is received for /content/test.html<br>        /cache<br>        {<br>         ...<br>         /rules<br>         {<br>          /0001 {<br>          type "deny"<br>          glob "*"<br>          }<br>         }<br>        }<br>    ```<br><br> | 未快取 |
   | --- | --- |
   | <br><br>    ```<br>    Farm has /cache = /rules and a request is received for /content/test.html<br>        /cache<br>        {<br>         ...<br>         /rules<br>         {<br>          /0001 {<br>          type "allow"<br>          glob "*"<br>          }<br>         }<br>        }<br>    ```<br><br> | cached |


5. HTTP請求不包含授權標頭，或包含標頭，但在伺服器陣列配置中，/ALLOWAUTHORIZED設定為1。
   <b>相關日誌消息：</b>


   ```
   request contains authorization
   ```



   <b>範例：</b>


   | HTTP要求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1    Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l<br>        dispatcher.any farm /cache = /allowAuthorized configuration:<br>        /cache {<br>           /allowAuthorized “0”    }<br>    ```<br><br> | 未快取 |
   | --- | --- |
   | HTTP要求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1    Authorization: Basic YWxhZGRpbjpvcGVuc2VzYW1l<br>        dispatcher.any farm /cache = /allowAuthorized configuration:<br>        /cache {<br>           /allowAuthorized “1”    }<br>    ```<br><br> | cached |


6. HTTP要求在COOKIE標題中包含LOGIN-TOKEN或AUTHORIZATION COOKIE，或包含（或兩者）這些Cookie，且/ALLOWAUTHORIZED在伺服器陣列設定中設為1。
   <b>相關日誌消息：</b>


   ```
   request contains authorization
   ```



   <b>範例：</b>


   | HTTP要求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1    Cookie: login-token=…<br>        dispatcher.any farm /cache = /allowAuthorized configuration:<br>        /cache {<br>           /allowAuthorized “0”    }<br>    ```<br><br> | 未快取 |
   | --- | --- |
   | HTTP要求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1    Cookie: authorization=YWxhZGRpbjpvcGVuc2VzYW1l<br>        dispatcher.any farm /cache = /allowAuthorized configuration:<br>        /cache {<br>           /allowAuthorized “0”    }<br>    ```<br><br> | 未快取 |
   | HTTP要求：<br><br>    ```<br>    GET /content/test.html HTTP/1.1    Cookie: login-token=…<br>        dispatcher.any farm /cache = /allowAuthorized configuration:<br>        /cache {<br>           /allowAuthorized “1”    }<br>    ```<br><br> | cached |


7. URL中有QUERYSTRING參數，且可透過伺服器陣列的/IGNOREURLPARAMS CONFIGURATION來忽略參數。
   <b>相關日誌消息：</b>


   ```
   request contains a query string
   ```



   <b>範例：</b>


   | HTTP要求：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1    Farm /cache configuration:<br>        /ignoreUrlParams {     /0001 { /type “allow” /glob “*” }    }<br>    ```<br><br> | cached |
   | --- | --- |
   | HTTP要求：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1    Farm /cache configuration:<br>        /ignoreUrlParams {     /0001 { /type “deny” /glob “*” } <br>           /0001 { /type “allow” /glob “test” }    }<br>    ```<br><br> | cached |
   | HTTP要求：<br><br>    ```<br>    GET /content/test.html?test=1 HTTP/1.1    dispatcher.any farm /cache = /allowAuthorized configuration:<br>        /ignoreUrlParams {<br>         /0001 { /type “deny” /glob “*” } <br>           /0001 { /type “allow” /glob “q” }    }<br>    ```<br><br> | 未快取 |



<b>HTTP回應和快取規則：</b>

如果符合下列條件，從AEM傳回的HTTP回應便可快取：

1. Dispatcher能夠從定義的「RENDERS」之一傳送並接收200 OK回應。

   <b>注意：</b> 若否 [/timeout](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=zh-Hant) 在/renders上設定，或設為0，則會等待連線至AEM例項，即使例項關閉亦然。
   <b>相關日誌消息：</b>


   ```
   Unable to send request to remote server. Unable to receive response from remote server. Remote server returned: %s No backend available.
   ```



   <b>範例：</b>


   | HTTP要求：<br><br>    200 OK | cached |
   | --- | --- |
   | HTTP要求：<br><br>    找不到404頁 | 未快取 |


2. 回應中未出現下列回應標題：

   - `Dispatcher: no-cache`
   - `Cache-control: no-cache`
   - `Pragma: no-cache`

   <b>相關日誌消息：</b>


   ```
   Backend forbids caching: %s, sent: %s" response contains no_cache
   ```



   <b>範例：</b>


   | HTTP回應：<br><br>    200 OK<br><br>    Dispatcher:無快取 | 未快取 |
   | --- | --- |
   | HTTP回應：<br>    <br><br>    200 OK<br><br>    快取控制：無快取 | 未快取 |
   | HTTP回應：<br><br>    200 OK<br><br>    編譯指示：無快取 | 未快取 |
   | HTTP回應：<br><br>    200 OK<br> | cached |


3. 內容長度值大於零位元組。
   <b>相關日誌消息：</b>


   ```
   response content length is zero
   ```



   <b>範例：</b>


   | HTTP回應：<br><br>    200 OK<br><br>    內容長度：0 | 未快取 |
   | --- | --- |
   | HTTP回應：<br><br>    200 OK<br><br>    內容長度：3120 | cached |


