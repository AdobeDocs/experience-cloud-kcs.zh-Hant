---
title: '"配置檔案的說明 | AEM'
description: 說明
solution: Experience Manager
product: Experience Manager
applies-to: "Experience Manager"
keywords: 「KCS」
resolution: Resolution
internal-notes: null
bug: false
article-created-by: Nayanika Chakravarty
article-created-date: "5/19/2023 8:23:39 PM"
article-published-by: Nayanika Chakravarty
article-published-date: "5/19/2023 9:00:14 PM"
version-number: 4
article-number: KA-17477
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=61e25106-83f6-ed11-8848-6045bd006a22"
source-git-commit: 94f7905d145d2ce7b001aa5254d172788eef54ff
workflow-type: tm+mt
source-wordcount: '1883'
ht-degree: 0%

---

# 配置檔案的說明 |AEM

## 說明 {#description}

<b>環境</b>
Experience Manager


<b>問題/症狀</b>
本文檔將分解並解釋在Adobe Managed Services中預配的標準構建調度程式伺服器中部署的每個配置檔案。 它們的使用、命名約定等。

<b>命名約定</b>

當使用include或include可選語句將檔案作為目標時，Apache Webserver實際上並不關心檔案的檔案副檔名。 用能消除衝突和混亂的名字正確命名它們，會幫上大忙。 使用的名稱將描述檔案應用的範圍，使生活更輕鬆。 如果所有內容都被命名為.conf，這會變得非常混亂。 我們希望避免檔案和副檔名名稱不佳。

下面是在典型AMS配置調度程式中使用的不同自定義檔案副檔名和命名約定的清單。

<u>conf.d/中包含的檔案</u>


| 檔案 | 檔案目標 | 說明 |
| --- | --- | --- |
| `<` 檔案名`>` .conf | /etc/httpd/conf.d | 預設的Enterprise Linux安裝使用此檔案副檔名並包含資料夾作為覆蓋httpd.conf中設定的位置，並允許您在Apache的全局級別添加其他功能。 |
| `<` 檔案名`>` .vhost | 已轉移：/etc/httpd/conf.d/available_vhosts/<br><br>活動：<br><br>/etc/httpd/conf.d/enabled_vhosts/<br><br><u style="box-sizing: border-box; border: 0 none">*注意：.vhost檔案不會複製到enabled_vhosts資料夾中，而是使用指向available_vhosts/ .vhost檔案相對路徑的符號連結</u> | \*.vhost（虛擬主機）檔案 `<` 虛擬主機 `>`  匹配主機名的條目，並允許Apache使用不同的規則處理每個域通信。 在.vhost檔案中，將包括其他檔案，如重寫、白名單等。 |
| `<` 檔案名`>` _rewrite.rules | /etc/httpd/conf.d/rewrites/ | `*_rewrite.rules` 檔案儲存 `mod_rewrite` vhost檔案明確使用的規則 |
| `<` 檔案名`>` _白名單/規則 | /etc/httpd/conf.d/白名單/ | \*_ipwhitelist.rules檔案包含在\*.vhost檔案中。 它包含允許IP白名單的IP規則運算式或允許拒絕規則。 如果您試圖限制基於IP地址查看虛擬主機，您將生成其中一個檔案，並將其從\*.vhost檔案中包含 |


<u>conf.modules.d/中包含的檔案</u>


| 檔案 | 檔案目標 | 說明 |
| --- | --- | --- |
| `<` 檔案名`>` .any | /etc/httpd/conf.dispatcher.d/ | Dispatcher AEM Apache模組從\*.any檔案中源出其設定。 預設的父包含檔案為conf.dispatcher.d/dispatcher.any |
| `<` 檔案名`>` _farm.any | <u>已轉移</u>:<br><br>/etc/httpd/conf.dispatcher.d/available_farms/<br><br><u>活動</u>:<br><br>/etc/httpd/conf.dispatcher.d/enabled_farms/<br><br><u style="box-sizing: border-box; border: 0 none">*注意：這些場檔案不會複製到enabled_farms資料夾中，而是使用指向available_farms/相對路徑的符號連結 _farm.any檔案</u>\*_ farm.any檔案包含在conf.dispatcher.d/dispatcher.any檔案中。 這些父場檔案用於控制每個呈現或網站類型的模組行為。 檔案在available_farms目錄中建立，並在enabled_farms目錄中使用符號連結啟用。<br><br>它按dispatcher.any檔案的名稱自動包含它們。<br><br>基線場檔案以000開頭&#x200B;_確保先裝上。<br><br>自定義場檔案應在100開始其編號方案後載入_ 來確保行為正確。 |
| `<` 檔案名`>` _filters_any | /etc/httpd/conf.dispatcher.d/filters////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// | \*filters.any檔案包含在conf.dispatcher.d/enabled_farms/\*_farm.any檔案中。 每個伺服器場都有一組規則，這些規則會更改應過濾掉的流量，而不是將流量傳送給投遞者。 |
| `<` 檔案名`>` _vhosts_any | /etc/httpd/conf.dispatcher.d/vhosts/ | \*_vhosts.any檔案包含在conf.dispatcher.d/enabled_farms/\*_farm.any檔案中。 這些檔案是要由blob匹配匹配的主機名或URI路徑的清單，用於確定用哪個呈現器來服務該請求 |
| `<` 檔案名`>` _cache_any | /etc/httpd/conf.dispatcher.d/cache/ | \*_cache.any檔案包含在conf.dispatcher.d/enabled_farms/\*_farm.any檔案中。 這些檔案指定哪些項被快取，哪些項未快取 |
| `<` 檔案名`>` _invalidate_allowed_any | /etc/httpd/conf.dispatcher.d/cache/ | \*_invalidate_allowed.any檔案包含在conf.dispatcher.d/enabled_farms/\*_farm.any檔案中。 它們指定允許發送刷新和無效請求的IP地址。 |
| `<` 檔案名`>` _clietheaders.any | /etc/httpd/conf.dispatcher.d/clientheaders/ | \*_clientheaders.any檔案包含在conf.dispatcher.d/enabled_farms/\*_farm.any檔案中。 它們指定應將哪些客戶端標頭傳遞到每個呈現器。 |
| `<` 檔案名`>` _renders_any | /etc/httpd/conf.dispatcher.d////// | \*_renders.any檔案包含在conf.dispatcher.d/enabled_farms/\*_farm.any檔案中。 它們為每個呈現器指定IP、埠和超時設定。 正確的呈現器可以是生命週期伺服器或調度AEM程式可以從中獲取/代理請求的任何系統 |


<b>避免的問題</b>

在遵循命名約定時，您可以避免一些容易出錯的錯誤，這些錯誤可能會導致災難性的結果。 我們將介紹幾個例子。

<u>問題示例</u>

作為ExampleCo的站點示例，調度程式配置的開發人員建立了兩個配置檔案。

`/etc/httpd/conf.d/exampleco.conf`


```
`<` VirtualHost *:80`>` 

    ServerName  "exampleco"

    ServerAlias "www.exampleco.com"

    .......... SNIP ...............

    `<` IfModule mod_rewrite.c`>` 

        ReWriteEngine   on

        LogLevel warn rewrite:trace1

        Include /etc/httpd/conf.d/rewrites/exampleco.conf

    `<` /IfModule`>` 

`<` /VirtualHost`>`
```


`/etc/httpd/conf.d/rewrites/exampleco.conf`


```
RewriteRule /$ /content/exampleco/en.html `[` PT,L`]` 

RewriteRule /robots.txt$ /content/dam/exampleco/robots.txt `[` PT,L`]`
```


<b>潛在危險</b>

<b>答：檔案名相同</b>

如果vhost檔案意外地放入重寫資料夾，而重寫檔案被放入vhosts資料夾。 它似乎按檔案名正確部署，但Apache將引發錯誤，問題不會立即顯現。

<b>這通常會成為一個問題？</b>

如果將兩個檔案下載到同一位置，則它們可以覆蓋它們本身，或者使其無法區分，使部署過程成為噩夢。

<b>B檔案副檔名相同且易於自動包含</b>

檔案副檔名相同，使用自動包含的副檔名，Apache將在其許多預設資料夾中自動包含任何.conf檔案。

<b>這通常會成為一個問題？</b>

如果副檔名為.conf的vhost檔案放在/etc/httpd/conf.d/資料夾中，它將嘗試將其載入到Apache上的記憶體中，但如果副檔名為.conf的重寫規則檔案被放在 `/etc/httpd/conf.d/` 資料夾，它將獲得自動包含並應用全局，從而導致混淆和不希望的結果。


## 解決方法 {#resolution}


根據檔案的操作和安全地離開自動包含規則命名空間命名檔案。

- 如果是虛擬主機檔案名，則 `.vhost` 作為擴展。
- 如果是重寫規則檔案，請將其命名為「&lt;」` site`>` _rewrite.rules` 作為尾碼和擴展。 此命名約定將明確其用於哪個站點，並且是一組重寫規則。
- 如果是IP白名單規則檔案，請將其命名為&quot;&lt;` description`>` _whitelist.rules` 作為尾碼和擴展。 此命名約定將提供一些說明，說明它用於什麼，並且是一組IP匹配規則。


如果檔案被移動到不屬於的自動包含目錄，則使用這些命名約定將避免問題。

例如，將名為.rules、.any或.vhost的檔案放入的auto-include資料夾中 `/etc/httpd/conf.d/` 不會有任何影響。

如果部署更改請求顯示 `please deploy exampleco_rewrite.rules to production dispatchers` 部署更改的人員已經知道他們沒有添加新站點；他們只是在更新檔案名所指示的重寫規則。

<b>包括訂單</b>

在Enterpise Linux上安裝的Apache Webserver中擴展功能和配置時，您有一些重要的 <b>包含訂單</b> 你會想明白的。

答： <u>Apache基線包括</u>

![apache基線包括順序。  apache二進位檔案以httpd.conf啟動，該檔案對conf.d/*.conf和conf.modules.d/*.conf目錄](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-Baseline-Includes.png "Apache-Webserver-Baseline-Include")

如上圖所示，httpd二進位檔案只將httpd.conf檔案作為配置檔案進行查找。 該檔案中包含以下語句：


```
Include conf.modules.d/*.conf

IncludeOptional conf.d/*.conf
```


B <u>AMS頂層包括</u>

在應用我們的標準時，我們添加了一些附加的檔案類型並包括我們自己的檔案類型。

這是AMS基線目錄和頂層包括

![AMS基線包括以dispatcher_vhost.conf開頭，該dispatcher_vhost.conf將包括/etc/httpd/conf.d/enabled_vhosts/目錄中*.vhost中的任何檔案。  /etc/httpd/conf.d/enabled_vhosts/目錄中的項是指向/etc/httpd/conf.d/available_vhosts/中實際配置檔案的符號連結](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS-Baseline-Includes.png "Apache-Webserver-AMS-Baseline-Include")

根據Apache的基線，我們將顯示AMS如何建立某些附加資料夾和頂級包括 `conf.d` 資料夾以及嵌套在 `/etc/httpd/conf.dispatcher.d/`

Apache載入時，它將 `/etc/httpd/conf.modules.d/02-dispatcher.conf` 該檔案將包含二進位檔案 `/etc/httpd/modules/mod_dispatcher.so` 進入運行狀態。


```
LoadModule dispatcher_module modules/mod_dispatcher.so
```


在我們的 ``<` /VirtualHost`>`` 我們將配置檔案放入 `/etc/httpd/conf.d/` 命名 `dispatcher_vhost.conf` 在此檔案中，您將看到使用設定模組工作所需的基本參數：


```
IfModule disp_apache2.c 

DispatcherConfig conf.dispatcher.d /dispatcher .any

...SNIP...

/IfModule
```


如上所示，這包括頂層dispatcher.any檔案，用於我們的dispatcher模組從 `/etc/httpd/conf.dispatcher.d/dispatcher.any`

請注意此檔案的內容：


```
/farms {

   $include "enabled_farms/*_farm.any"

}
```


頂級dispatcher.any檔案包括位於的所有已啟用的場檔案 `/etc/httpd/conf.dispatcher.d/enabled_farms/` 檔案名為「&lt;」` FILENAME`>` _farm.any` 符合我們標準的命名規範。

在 `dispatcher_vhost.conf` 前面提到的檔案我們還執行include語句以啟用位於中的每個已啟用的虛擬主機檔案 `/etc/httpd/conf.d/enabled_vhosts/` 檔案名為&quot;&lt;` FILENAME`>` .vhost` 符合我們標準的命名規範。


```
IncludeOptional /etc/httpd/conf.d/enabled_vhosts/*.vhost
```


在我們的每個.vhost檔案中，您都會注意到調度程式模組被初始化為目錄的預設檔案處理程式。 下面是一個示例.vhost檔案，用於顯示語法：


```
`<` VirtualHost *:80`>` 

    ServerName    "weretail"

    ServerAlias www.weretail.com weretail.com

    `<` Directory /`>` 

        `<` IfModule disp_apache2.c`>` 

            ....SNIP....

            SetHandler dispatcher-handler

        `<` /IfModule`>` 

        ....SNIP....

    `<` /Directory`>` 

    ....SNIP....

`<` /VirtualHost`>`
```


在頂層包含解決之後，他們還有其他子包含值得一提。 下面是關於場和vhosts檔案如何包括其他子元素的高級圖

C. <u>AMS虛擬主機包括</u>

![ams虛擬主機包括子項。  此圖顯示了一個.vhost檔案如何包括變數、白名單和重寫資料夾中的檔案](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS-Vhost-Includes.png "Apache-Webserver-AMS-Vhost-Include")

當任何.vhost檔案來自 `/etc/httpd/conf.d/availabled_vhosts/` 目錄被連結到 `/etc/httpd/conf.d/enabled_vhosts/` 用於運行配置的目錄。

.vhost檔案包含基於我們找到的公用項的子包。  變數、白名單和重寫規則等。

.vhost檔案將根據每個檔案需要包含在.vhost檔案中的位置為每個檔案包含語句。  下面是.vhost檔案的一個示例語法，作為好的引用：


```
Include /etc/httpd/conf .d /variables/weretail .vars VirtualHost *:80

ServerName    "${MAIN_DOMAIN}" 

Directory /          Include /etc/httpd/conf .d /whitelists/weretail *_whitelist.rules

IfModule disp_apache2.c

....SNIP....

SetHandler dispatcher-handler

/IfModule

....SNIP....

/Directory

....SNIP....

IfModule mod_rewrite.c

ReWriteEngine   on

LogLevel warn rewrite:trace1

Include /etc/httpd/conf .d /rewrites/weretail_rewrite .rules

/IfModule /VirtualHost
```


如上例所示，此配置檔案中需要的變數在以後使用時包含。

檔案內 `/etc/httpd/conf.d/variables/weretail.vars` 我們可以看到定義了哪些變數：


```
Define MAIN_DOMAIN dev.weretail.com
```


您還可以看到一行，其中包含白名單.rules檔案清單，這些檔案根據不同的白名單標準限制哪些人可以查看此內容。 讓我們查看其中一個白名單檔案的內容 `/etc/httpd/conf.d/whitelists/weretail_mainoffice_whitelist.rules`:


```
`<` RequireAny`>` 

  Require ip 192.150.16.0/23

`<` /RequireAny`>`
```


您還可以看到包含一組重寫規則的行。 我們來看一下 `weretail_rewrite.rules` 檔案：


```
RewriteRule /robots.txt$ /content/dam/weretail/robots.txt `[` NC,PT`]` 

RewriteCond %{SERVER_NAME} brand1.weretail.net `[` NC`]` 

RewriteRule /favicon.ico$ /content/dam/weretail/favicon.ico `[` NC,PT`]` 

RewriteCond %{SERVER_NAME} brand2.weretail.com `[` NC`]` 

RewriteRule /sitemap.xml$ /content/weretail/general/sitemap.xml `[` NC,PT`]` 

RewriteRule /logo.jpg$ /content/dam/weretail/general/logo.jpg `[` NC,PT`]`
```


D <u>AMS場包括</u>

![<FILENAME>_farms.any將包含子.any檔案以完成場配置。  在此圖中，您可以看到伺服器場將包括每個頂級節檔案快取、客戶端引導程式、篩選器、呈現和vhosts .any檔案](https://helpx.adobe.com/content/dam/kb/en/ams-dispatcher-manual/Apache-Webserver-AMS.-Farm-Includes.png "Apache-Webserver-AMS-Farm-Include")

當有&quot;&lt;` FILENAME`>` _farm.any` 檔案 `/etc/httpd/conf.dispatcher.d/available_farms/` 目錄被連結到 `/etc/httpd/conf.dispatcher.d/enabled_farms/` 用於運行配置的目錄。

場檔案具有子包含，基於 [農場的頂級部分](https://experienceleague.adobe.com/docs/experience-manager-dispatcher/using/configuring/dispatcher-configuration.html?lang=en#defining-farms-farms) 如快取、客戶端引導程式、篩選器、呈現和vhosts。

的 ``<` FILENAME`>` _farm.any` files will have include statements for each file based on where they need to be included in the farm file. Here is an example syntax of a ``&lt;` FILENAME`>` _farm.any` 檔案作為良好引用：


```
/weretailfarm {  

    /clientheaders {

        $include "/etc/httpd/conf.dispatcher.d/clientheaders/ams_publish_clientheaders.any"

        $include "/etc/httpd/conf.dispatcher.d/clientheaders/ams_common_clientheaders.any"

    }

    /virtualhosts {

        $include "/etc/httpd/conf.dispatcher.d/vhosts/weretail_vhosts.any"

    }

    /renders {

        $include "/etc/httpd/conf.dispatcher.d/renders/ams_publish_renders.any"

    }

    /filter {

        $include "/etc/httpd/conf.dispatcher.d/filters/ams_publish_filters.any"

        $include "/etc/httpd/conf.dispatcher.d/filters/weretail_search_filters.any"

    }

    ....SNIP....

    /cache {

        ....SNIP....

        /rules {

            $include "/etc/httpd/conf.dispatcher.d/cache/ams_publish_cache.any"

        }

        ....SNIP....

        /allowedClients {

            /0000 {

                /glob "*.*.*.*"

                /type "deny"

            }

            $include "/etc/httpd/conf.dispatcher.d/cache/ams_publish_invalidate_allowed.any"

        }

    ....SNIP....

    }

}
```


正如您可以看到weretail場的每個部分，而不是使用include語句，而是使用所需的所有語法。

讓我們看一下其中幾個包含的語法，以瞭解每個子包含的樣式 `/etc/httpd/conf.dispatcher.d/vhosts/weretail_publish_vhosts.any`:


```
"brand1.weretail.com"

"brand2.weretail.com"

"www.weretail.comf"
```


正如您所看到的，它是一個新行分隔的域名清單，應從此伺服器場呈現到其他伺服器場上。

下面來看 `/etc/httpd/conf.dispatcher.d/filters/weretail_search_filters.any`:


```
/400 { /type "allow" /method "GET" /path "/bin/weretail/lists/*" /extension "json" }

/401 { /type "allow" /method "POST" /path "/bin/weretail/search/" /extension "html" }
```

