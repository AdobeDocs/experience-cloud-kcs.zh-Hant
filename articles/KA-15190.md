---
title: 「增量查詢」會挑選所有記錄，而不只是新記錄」
description: 說明
solution: Campaign
product: Campaign
applies-to: "Campaign Classic"
keywords: "KCS"
resolution: Resolution
internal-notes: "Ticket = TK197178"
bug: true
article-created-by: Tanay Sharma .
article-created-date: "9/26/2022 10:11:48 AM"
article-published-by: Tanay Sharma .
article-published-date: "9/26/2022 11:03:23 AM"
version-number: 3
article-number: KA-15190
dynamics-url: "https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=e647789f-833d-ed11-9db1-002248086735"
source-git-commit: c07227262cb059b09254e8e1ec01542d4de2a881
workflow-type: tm+mt
source-wordcount: '353'
ht-degree: 0%

---

# 增量查詢會挑選所有記錄，而非僅挑選新記錄

## 說明

<b>環境</b>
Campaign Classic


<b>問題/症狀</b>
增量查詢未如預期運作。 他們不僅從上次運行後提取新記錄，而且每次都像正常查詢活動一樣提取所有記錄。


## 解析度


此問題已在Adobe Campaign Classic 20.1.1版（版本編號9122及以上）中修正。

<b>客戶可使用的因應措施：</b>

<b>解決方法1</b>:停止清除工作流，並間歇性地運行它以清除資料庫和硬碟，直到進行修復並可用為止。 如果您沒有計畫的升級，則不建議使用。

<b>解決方法2</b>:假設增量查詢活動受到影響。 通過建立保存歷史記錄表內容的持久架構來執行增量查詢所執行的相同操作來解決此問題。 使用查詢和更新資料活動的組合來模擬行為。 這必須針對所有需要增量查詢的工作流程完成。

<b>解決方法3</b>:  假設增量查詢活動受到影響。 新增稽核欄位以解決此問題 `tsCreated/tsLastModified` 到有關的方案。 然後，您的增量查詢將轉換為具有where子句(如&#39;tscreated GetDate()&quot;)的普通查詢活動。

<b>解決方法4</b>:

1. 建立新序列 `xtknewworkflowid` 並初始化它，使其遠離目前的workflowId範圍。
2. 變更 `xtkworkflow` 使用此架構的方案 `pkSequence`.
3. 請客戶複製所有受影響的工作流程，並刪除原始的工作流程。
4. 客戶準備好進行升級後，請回復為以移除此修正 `xtknewId` 用於建立工作流程（以避免意外情況）。

<b>原因</b>
罪魁禍首是清理工作流程。

增量查詢工作流的運作方式如下：

1. 維護一個歷史記錄表，其中包含以前迭代的結果。
2. 從目標查詢中擷取所有列。
3. 篩選出歷史記錄表格中顯示的所有列
4. 將剩餘結果添加到歷史記錄表中，以便進行下一次迭代篩選。


因此，此歷史記錄工作表名稱具有以下符號：
`wkfhistoworkflowid` `activityName_`

現在，針對workflowIDs 0(適用於 `xtknewid` 允許負序列)，我們發現它實際上是：

`wkfhisto(uint)workflowid``activityName_`

`Although this is okay for workflow execution.`

`So, for example, the incremental activity incremental1 of workflow ID=-1 will create a table wkfhisto4294967295_incremental1`.&#39;

`The thing which is missed is the CleanUp workflow.`

`Here, we have a code that tries to delete worktables of deleted workflows.`

`A dedicated code here lists all the wkfhisto tables, extracts the workflowId from their names (from the above convention), and deletes them all except the ones whose worklowIDs are found in the xtkworkflow table.`

`However, it misses the uint part.`

`So, it tries to look up a workflow with ID 4294967295 instead of casting this back to int. Since this workflow is not found, this table is deleted. Next time, when this workflow runs, the incremental query activity does not find an existing history table and creates it thinking of this as the first run ever.`
