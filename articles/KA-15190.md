---
title: Campaign Classic- [!UICONTROL 增量查詢] 會挑選所有記錄，而非只有新記錄
description: 說明
solution: Campaign
product: Campaign
applies-to: Campaign Classic
keywords: KCS
resolution: Resolution
internal-notes: Ticket = TK197178
bug: true
article-created-by: Marta Zator
article-created-date: 5/10/2022 9:47:14 AM
article-published-by: Marta Zator
article-published-date: 5/10/2022 9:51:21 AM
version-number: 2
article-number: KA-15190
dynamics-url: https://adobe-ent.crm.dynamics.com/main.aspx?forceUCI=1&pagetype=entityrecord&etn=knowledgearticle&id=ad8bd527-46d0-ec11-a7b5-00224809c101
exl-id: f3dee0a7-8047-4949-9162-de95ba07fa7f
source-git-commit: dc1937169029c76dbce1ba513dd6430dffbc86c5
workflow-type: tm+mt
source-wordcount: '516'
ht-degree: 0%

---

# Campaign Classic- [!UICONTROL 增量查詢] 會挑選所有記錄，而非只有新記錄

## 說明

客戶有多個增量查詢，但無法如預期運作。 他們每次都會擷取所有記錄，而不是只擷取自上次執行以來的新記錄，就像正常情況一樣 [!UICONTROL 查詢] 活動。

## 解決方法

罪魁禍首是 [!UICONTROL Cleanup] 工作流程。

此 [!UICONTROL 增量查詢] 工作流程的運作方式如下：

1. 維護含有先前版序結果的歷史記錄表格。
1. 從目標查詢中擷取所有列。
1. 篩選掉歷史記錄表格中的所有列
1. 將剩餘的結果加入至歷史記錄表格中，以供下一個反複專案篩選使用。

因此，此歷程記錄工作表名稱有下列表示法：

*wkfhistoworkflowid* activityname_

現在，針對workflowID 0 (針對將 `xtknewid` 允許負數序列)，我們看到它實際上是：

*wkfhisto(uint)workflowid* activityname_

但這適用於工作流程執行。

例如，增量活動 `incremental1` （工作流程ID=-1）會建立表格 `wkfhisto4294967295_incremental1`.

我們忽略的是 [!UICONTROL Cleanup] 工作流程。

在此處，我們有一個程式碼，會嘗試刪除已刪除工作流程的工作表。

此處的專用程式碼會列出所有wkfhisto\*表格、從名稱中擷取workflowId （根據上述慣例），並刪除所有表格（在xtkworkflow表格中找到workflowID的表格除外）。

但是，它會遺漏 `uint` 部分。

因此，它會嘗試使用ID 4294967295尋找工作流程，而不是將此轉型回int。 由於找不到此工作流程，因此會刪除此表格。 下次執行此工作流程時， [!UICONTROL 增量查詢] 活動找不到現有的歷程記錄表格，並將它建立為有史以來的首次執行。

<b>修正：</b>

Adobe Campaign Classic 20.1.1版（版本編號9122及更高版本）中提供此問題的修正。

<b>客戶可使用的因應措施：</b>

解決方法1：停止清理工作流程，並間歇性執行以清理資料庫和硬碟，直到進行修正並可供使用為止。 如果您沒有計畫的升級，則不建議使用。

解決方法2：假設 [!UICONTROL 增量查詢] 活動會受到影響，請採取與 [!UICONTROL 增量查詢] 建立持續性綱要以儲存歷史記錄表格內容。 使用組合 [!UICONTROL 查詢] 和 [!UICONTROL 更新資料] 活動以模擬行為。 針對所有需要增量查詢的工作流程，這些工作流程都必須完成。

解決方法3：假設 [!UICONTROL 增量查詢] 活動會受到影響，請透過將稽核欄位(tsCreated/tsLastModified)新增到有問題的結構描述來處理。 然後，您的增量查詢將轉換為具有Where子句(例如 `tscreated GetDate()`.

因應措施4：

- 建立新的序列xtknewworkflowid，並將其初始化為遠離目前workflowId範圍的某個專案。
- 變更xtkworkflow結構以使用此 `pkSequence`
- 要求客戶複製所有受影響的工作流程，並刪除原始的工作流程。
- 客戶準備好升級後，請回覆至 `xtknewId` 用於建立工作流程（以避免不必要的意外）。
